/*
====================================================================
Day 32 â€” try / catch / finally êµ¬ì¡° ì´í•´
Module: 03_async / 04_error_handling

ğŸ“Œ ëª©í‘œ
1) ë™ê¸° ì½”ë“œì—ì„œì˜ try/catch ë™ì‘ ì›ë¦¬ ì´í•´
2) async/await í™˜ê²½ì—ì„œì˜ ì—ëŸ¬ ì²˜ë¦¬ ë°©ì‹ ì´í•´
3) finally ë¸”ë¡ì˜ ì‹¤í–‰ ë³´ì¥ íŠ¹ì„± ì´í•´
4) ì‹¤ë¬´ì—ì„œì˜ ì—ëŸ¬ ì¬ì „ë‹¬(rethrow) íŒ¨í„´ ì´í•´

ì´ íŒŒì¼ì€ "ì—ëŸ¬ë¥¼ ë¬¸ë²•ì´ ì•„ë‹ˆë¼ êµ¬ì¡°ì ìœ¼ë¡œ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ”ê°€"
ë¥¼ ë³´ì—¬ì£¼ëŠ” ì˜ˆì œì…ë‹ˆë‹¤.
====================================================================
*/


/* ================================================================
1ï¸âƒ£ ë™ê¸°(Synchronous) ì½”ë“œì—ì„œì˜ try/catch
================================================================ */

/*
try ë¸”ë¡:
  - ì—ëŸ¬ê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìˆëŠ” ì½”ë“œë¥¼ ê°ì‹¼ë‹¤.

catch ë¸”ë¡:
  - try ë‚´ë¶€ì—ì„œ ë°œìƒí•œ ì—ëŸ¬ë¥¼ ë°›ì•„ ì²˜ë¦¬í•œë‹¤.

finally ë¸”ë¡:
  - ì„±ê³µ/ì‹¤íŒ¨ì™€ ê´€ê³„ì—†ì´ í•­ìƒ ì‹¤í–‰ëœë‹¤.
*/

function parseJSON(input) {
  try {
    // JSON.parseëŠ” ì˜ëª»ëœ í˜•ì‹ì¼ ê²½ìš° ì—ëŸ¬ë¥¼ ë˜ì§„ë‹¤(throw).
    const parsed = JSON.parse(input);

    console.log("âœ” JSON íŒŒì‹± ì„±ê³µ:", parsed);
    return parsed;

  } catch (error) {
    // ì—ëŸ¬ ê°ì²´ì—ëŠ” message, stack ë“±ì˜ ì •ë³´ê°€ ë“¤ì–´ ìˆë‹¤.
    console.error("âŒ JSON íŒŒì‹± ì‹¤íŒ¨:", error.message);
    return null;

  } finally {
    // finallyëŠ” ë¬´ì¡°ê±´ ì‹¤í–‰ëœë‹¤.
    console.log("â–¶ parseJSON ì‹¤í–‰ ì¢…ë£Œ\n");
  }
}

// ì •ìƒ ì¼€ì´ìŠ¤
parseJSON('{"name":"Jun"}');

// ì—ëŸ¬ ë°œìƒ ì¼€ì´ìŠ¤
parseJSON("ì˜ëª»ëœ JSON ë¬¸ìì—´");



/* ================================================================
2ï¸âƒ£ async / await í™˜ê²½ì—ì„œì˜ try/catch
================================================================ */

/*
Promiseê°€ reject ë˜ë©´,
await êµ¬ë¬¸ì—ì„œ "ì—ëŸ¬ì²˜ëŸ¼" ë™ì‘í•˜ë©° catchë¡œ ì´ë™í•œë‹¤.
*/

function mockApi(success = true) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      if (success) {
        resolve("ë°ì´í„° ë¡œë”© ì„±ê³µ");
      } else {
        reject(new Error("API ìš”ì²­ ì‹¤íŒ¨"));
      }
    }, 1000);
  });
}


async function fetchData(success) {
  try {
    console.log("ğŸ“¡ ìš”ì²­ ì‹œì‘...");

    // awaitëŠ” Promiseê°€ resolveë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.
    // rejectë˜ë©´ catch ë¸”ë¡ìœ¼ë¡œ ì´ë™í•œë‹¤.
    const result = await mockApi(success);

    console.log("âœ” ê²°ê³¼:", result);

  } catch (error) {
    // rejectëœ ì—ëŸ¬ê°€ ì—¬ê¸°ë¡œ ì „ë‹¬ëœë‹¤.
    console.error("âŒ ì—ëŸ¬ ë°œìƒ:", error.message);

  } finally {
    // ìš”ì²­ ì„±ê³µ/ì‹¤íŒ¨ì™€ ê´€ê³„ì—†ì´ í•­ìƒ ì‹¤í–‰
    console.log("â–¶ ìš”ì²­ ì²˜ë¦¬ ì™„ë£Œ\n");
  }
}

// ì„±ê³µ ì¼€ì´ìŠ¤
fetchData(true);

// ì‹¤íŒ¨ ì¼€ì´ìŠ¤
fetchData(false);



/* ================================================================
3ï¸âƒ£ ì‹¤ë¬´ íŒ¨í„´ â€” ì—ëŸ¬ ì¬ë˜ì§€ê¸° (Rethrow Pattern)
================================================================ */

/*
ì‹¤ë¬´ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê³„ì¸µ êµ¬ì¡°ê°€ ìˆë‹¤:

Controller â†’ Service â†’ Repository(API/DB)

í•˜ìœ„ ê³„ì¸µì—ì„œ ì—ëŸ¬ë¥¼ ë¡œê·¸ë§Œ ì°ê³  ëë‚´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼,
ìƒìœ„ ê³„ì¸µì´ ìµœì¢… íŒë‹¨ì„ í•˜ë„ë¡ ì—ëŸ¬ë¥¼ ë‹¤ì‹œ throw í•œë‹¤.
*/

async function serviceLayer() {
  try {
    const data = await mockApi(false); // ì¼ë¶€ëŸ¬ ì‹¤íŒ¨
    return data;

  } catch (error) {
    console.error("ğŸ›  Service Layer ì—ëŸ¬ ë¡œê·¸:", error.message);

    // ìƒìœ„ ê³„ì¸µì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ì—ëŸ¬ë¥¼ ë‹¤ì‹œ ë˜ì§„ë‹¤.
    throw error;
  }
}

async function controllerLayer() {
  try {
    const result = await serviceLayer();
    console.log("Controller ê²°ê³¼:", result);

  } catch (error) {
    // ìµœì¢… ì‚¬ìš©ì ì‘ë‹µ ì²˜ë¦¬ ì˜ì—­
    console.error("ğŸš¨ Controller ìµœì¢… ì²˜ë¦¬:", error.message);
  }
}

controllerLayer();



/*
====================================================================
ğŸ“Œ í•µì‹¬ ì •ë¦¬

1. try/catchëŠ” ë™ê¸° ì½”ë“œì—ì„œ ì¦‰ì‹œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•œë‹¤.
2. async/awaitì—ì„œëŠ” Promiseê°€ reject ë˜ë©´ catchë¡œ ì´ë™í•œë‹¤.
3. finallyëŠ” í•­ìƒ ì‹¤í–‰ëœë‹¤.
4. ì‹¤ë¬´ì—ì„œëŠ” ì—ëŸ¬ë¥¼ ê³„ì¸µì ìœ¼ë¡œ ì „ë‹¬(rethrow)í•˜ëŠ” êµ¬ì¡°ê°€ ì¤‘ìš”í•˜ë‹¤.
5. ì—ëŸ¬ ì²˜ë¦¬ëŠ” ë‹¨ìˆœíˆ ì¡ëŠ” ê²ƒì´ ì•„ë‹ˆë¼,
   "ì–´ë””ì—ì„œ ì±…ì„ì§ˆ ê²ƒì¸ê°€"ë¥¼ ì„¤ê³„í•˜ëŠ” ë¬¸ì œì´ë‹¤.

ì´ íŒŒì¼ì€ ì—ëŸ¬ ì²˜ë¦¬ì˜ ë¬¸ë²•ì´ ì•„ë‹ˆë¼
"ì—ëŸ¬ ì²˜ë¦¬ ì•„í‚¤í…ì²˜"ì˜ ê¸°ì´ˆë¥¼ ì„¤ëª…í•˜ëŠ” ì˜ˆì œì´ë‹¤.
====================================================================
*/